window.Profile=window.Profile||{},window.Profile.BaseUrl=window.location.origin,window.Profile.Init=function(e,t,r,i,o,n){window.Profile.UpdateProfile({PremiumStatus:"Not Started",VisitedStages:[],Country:i,Role:r,UserId:e,LayerId:t,Device:o},n)},window.Profile.InitAsync=function(i,o,n,a,s,l){return new Promise((t,r)=>{try{var e={PremiumStatus:"Not Started",VisitedStages:[],Country:a,Role:n,UserId:i,LayerId:o,Device:s};window.Profile.UpdateProfile(e,e=>{t(e),l&&"function"==typeof l&&l()})}catch(e){r(e)}})},window.Profile.ConductExperiment=function(e,t){var r,i,o,n=0,a=setDefaultValues(e),s=JSON.parse(localStorage.getItem("UserProfile"));return s&&(a.IsBackend||s.LayerId)&&(r=s&&s.VisitedStages&&0<s.VisitedStages.length?s.VisitedStages.filter(function(e){return e.userStageId==a.StageID}):[],i=!(!a.UseRole||"Guest"==a.UseRole),!a.conductforguestusers||!i)&&(e.ignoreStageCheck||window.Profile.CheckStageEligibility(a.StageID))&&(!e.isRCExperiment||!checktrialPurchaseDate(s.TrialPurchaseDate))&&(i=!1,i=a.ExcludedCountry?-1==a.ExcludedCountry.indexOf(s.Country):-1<a.Country.indexOf(s.Country)||a.Country?.toString().toUpperCase().includes("ALL"),a.Device?.toString().toUpperCase().includes(s.Device?.toUpperCase()))&&i&&a.PremiumStatus?.toString().toUpperCase().includes(s.PremiumStatus?.toUpperCase())?(r&&0<r.length&&(e=s.VisitedStages.indexOf(r[0]),i={userStageId:a.StageID,userStageDateTime:new Date},s.VisitedStages[e]=i,localStorage.setItem("UserProfile",JSON.stringify(s))),void(a.IsBackend?conductBackendExperiment(s.UserId,a.ExprId,a.culture,a.logTraits,a.includeIterableIntegration,a.skipGoverning,t):window.experiment?(n=window.experiment.conductUserExperiment(s.UserId,s.LayerId,a.ExprId).variant||0,t&&"function"==typeof t&&t(n)):o=setInterval(function(){void 0!==window.experiment&&(clearInterval(o),n=window.experiment.conductUserExperiment(s.UserId,s.LayerId,a.ExprId).variant||0,t)&&"function"==typeof t&&t(n)},50))):n},window.Profile.UpdateUserPremiumStatus=function(e){var t;e&&((t=JSON.parse(localStorage.getItem("UserProfile"))).PremiumStatus=e,localStorage.setItem("UserProfile",JSON.stringify(t)))},window.Profile.UpdateStage=function(t){var e=JSON.parse(localStorage.getItem("UserProfile")),r=e.VisitedStages.filter(function(e){return e.userStageId==t}),i={userStageId:t,userStageDateTime:new Date};0<r.length?(r=e.VisitedStages.indexOf(r[0]),e.VisitedStages[r]=i):e.VisitedStages.push(i),localStorage.setItem("UserProfile",JSON.stringify(e))},window.Profile.UpdateLoginStatus=function(e){var t=JSON.parse(localStorage.getItem("UserProfile"));t.Role=e?"User":"Guest",localStorage.setItem("UserProfile",JSON.stringify(t))},window.Profile.UpdateProfile=function(t,r){var e=window.Profile.BaseUrl+(window.Profile.APISlug||"/eb/api")+"/v1/users/experimentprofile";-1<window.location.hostname.indexOf("local")&&window.Profile.localURL&&(e=window.Profile.localURL+"/v1/users/experimentprofile"),callAjaxExpProfile(e,"GET",!1,!0,function(e){e&&(e=JSON.parse(e),t.VisitedStages=e.userStageLogs,t.PremiumStatus=e.premiumStatus,t.TrialPurchaseDate=e.trialPurchaseDate),localStorage.setItem("UserProfile",JSON.stringify(t)),r&&"function"==typeof r&&r()},!1)},window.Profile.UpdateTrialPurchaseDate=function(e){var t=JSON.parse(localStorage.getItem("UserProfile"));t.TrialPurchaseDate=e,localStorage.setItem("UserProfile",JSON.stringify(t))},window.Profile.CheckStageEligibility=function(t){var e,r=!0,i=JSON.parse(localStorage.getItem("UserProfile")).VisitedStages.filter(function(e){return e.userStageId==t});return r=i&&0<i.length&&i[0].userStageDateTime&&(e=new Date,Math.round((e-new Date(i[0].userStageDateTime))/864e5)<14)?!1:r},window.Profile.CheckStgEligibilityAndReturnProfile=function(e){return{eligibility:window.Profile.CheckStageEligibility(e),UserProfile:JSON.parse(localStorage.getItem("UserProfile"))}},conductBackendExperiment=function(e,t,r,i=!0,o=!0,n=!0,a){var s=window.Profile.BaseUrl+(window.Profile.APISlug||"/eb/api")+"/v2/users/"+e+"/experiments/"+t+"/conduct";-1<window.location.hostname.indexOf("local")&&window.Profile.localURL&&(s=window.Profile.localURL+"/v2/users/"+e+"/experiments/"+t+"/conduct"),callAjaxExpProfile(s,"POST",!1,!0,a,!1,JSON.stringify({logTraits:i,conductForOldUsers:!0,includeIterableIntegration:o,culture:r,skipGoverning:n}))},setDefaultValues=function(e){return e.hasOwnProperty("PremiumStatus")||(e.PremiumStatus=["Not Started","Expired"]),e.hasOwnProperty("IsBackend")||(e.IsBackend=!1),e.hasOwnProperty("Country")||(e.Country=["ALL"]),e.hasOwnProperty("Device")||(e.Device="Desktop"),e.hasOwnProperty("culture")||(e.culture="en-US"),e.hasOwnProperty("ignoreStageCheck")||(e.ignoreStageCheck=!1),e},callAjaxExpProfile=function(e,t,r,i,o,n,a){var s=new XMLHttpRequest;s.onload=function(){4==s.readyState&&200==s.status?o&&(n?o(s.responseText,n):o(s.responseText)):4==s.readyState&&500==s.status&&o&&o("")},s.open(t,e,r),i&&(s.withCredentials=!0),a?(s.setRequestHeader("Content-Type","application/json;charset=UTF-8"),s.send(a)):s.send()},checktrialPurchaseDate=function(e){var t,r;return!e||(t=!1,r=new Date,14<Math.round((r-new Date(e))/864e5))||t};